#!/bin/bash

backupscript=<<-EOL
#!/bin/bash
for dat in `psql -tc "select datname from pg_database where datname !~ '^template'"`
do
  pg_dump -d $dat | xz -c > #{backup_dir}/$dat.dump.xz
done
#pg_dumpall -g | xz -c > #{backup_dir}/global.dump.xz
EOL

sudo su - postgres -c "${backupscript}"
